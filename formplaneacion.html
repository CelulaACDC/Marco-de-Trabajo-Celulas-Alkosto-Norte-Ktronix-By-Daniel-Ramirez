<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Plantilla de Planeaci√≥n de Sprint</title>
    <style>
        body { font-family: Arial, sans-serif; background-color: #f4f6f9; color: #333; margin: 20px; }
        h1, h2 { text-align: center; color: #003366; }
        .section { background-color: #fff; padding: 20px; border-radius: 8px; box-shadow: 0 2px 5px rgba(0,0,0,0.1); margin-bottom: 30px; }

        /* Tablas */
        table { width: 100%; border-collapse: collapse; margin-top: 10px; }
        th, td { border: 1px solid #ddd; padding: 10px; text-align: left; }
        tr:nth-child(even) td { background-color: #f9f9f9; }

        /* Formularios secci√≥n 1 */
        .form-row { display: flex; align-items: center; margin-bottom: 10px; }
        .form-row label { width: 180px; margin-right: 10px; text-align: right; }
        .form-row input[type="text"] { width: calc(100% - 190px); padding: 8px; border: 1px solid #ccc; border-radius: 4px; }

        /* Encabezados de tabla secci√≥n1 */
        .section1-table th { background-color: #007bff; color: #fff; }
        .section1-table input { width: 100%; padding: 6px; border: 1px solid #ccc; border-radius: 4px; box-sizing: border-box; }

        /* Botones */
        .submit-btn { background-color: #28a745; color: #fff; padding: 10px 20px; border: none; border-radius: 6px; cursor: pointer; font-size: 1em; }
        .submit-btn:hover { background-color: #218838; }
        #agregar-a-planeacion-btn { background-color: #007bff; color: #fff; padding: 8px 16px; border: none; border-radius: 4px; cursor: pointer; font-size: 0.9em; }
        #agregar-a-planeacion-btn:hover { background-color: #0056b3; }
        .edit-btn { background-color: #ffc107; color: #fff; border: none; padding: 5px 10px; border-radius: 4px; cursor: pointer; font-size: 0.8em; margin-right: 5px; }
        .edit-btn:hover { background-color: #e0a800; }
        .delete-btn { background-color: #dc3545; color: #fff; border: none; padding: 5px 10px; border-radius: 4px; cursor: pointer; font-size: 0.8em; }
        .delete-btn:hover { background-color: #c82333; }
        .clear-btn { background-color: #6c757d; color: #fff; padding: 8px 16px; border: none; border-radius: 4px; cursor: pointer; font-size: 0.9em; }
        .clear-btn:hover { background-color: #5a6268; }

        /* Tablas de resumen */
        #tabla-resumen-agregada th, #tabla-resumen-fijas th, #tabla-resumen-otras th { background-color: #28a745; color: #fff; }
    </style>
</head>
<body>

    <h1>üìã Planeaci√≥n de Sprint</h1>

    <div class="section">
        <h2>Secci√≥n 1: Actividades por Historia de Usuario (HU)</h2>

        <div class="form-row">
            <label for="nroSprint">NRO DE SPRINT:</label>
            <input type="text" id="nroSprint" name="nroSprint">
        </div>
        <div class="form-row">
            <label for="huId">ID de Historia de Usuario (HU):</label>
            <input type="text" id="huId" name="huId">
        </div>
        <div class="form-row">
            <label for="huName">Nombre de la HU:</label>
            <input type="text" id="huName" name="huName">
        </div>
        <div class="form-row">
            <label for="devAsignado">DEV ASIGNADO:</label>
            <input type="text" id="devAsignado" name="devAsignado">
        </div>
        <div class="form-row">
            <label for="qaAsignado">QA ASIGNADO:</label>
            <input type="text" id="qaAsignado" name="qaAsignado">
        </div>

        <table class="section1-table">
            <tr>
                <th>Actividad</th><th>Fecha Inicio</th><th>Fecha Fin</th><th>Horas (sugerido)</th>
            </tr>
            <tr>
                <td>1. Desarrollo</td>
                <td><input type="date" name="fechaDesarrolloInicio"></td>
                <td><input type="date" name="fechaDesarrolloFin"></td>
                <td><input type="number" name="horasDesarrollo" value="16"></td>
            </tr>
            <tr>
                <td>2. Dise√±o de casos de prueba (en paralelo con desarrollo)</td>
                <td><input type="date" name="fechaDisenoQAInicio"></td>
                <td><input type="date" name="fechaDisenoQAFin"></td>
                <td><input type="number" name="horasDisenoQA" value="8"></td>
            </tr>
            <tr>
                <td>3. Handoff t√©cnico</td>
                <td><input type="date" name="fechaHandoffInicio"></td>
                <td><input type="date" name="fechaHandoffFin"></td>
                <td><input type="number" name="horasHandoff" value="2"></td>
            </tr>
            <tr>
                <td>4. Liberaci√≥n a ambiente Dev (Deploy inicial)</td>
                <td><input type="date" name="fechaDeployInicio"></td>
                <td><input type="date" name="fechaDeployFin"></td>
                <td><input type="number" name="horasDeploy" value="2"></td>
            </tr>
            <tr>
                <td>5. Validaci√≥n QA (Ejecuci√≥n formal de pruebas)</td>
                <td><input type="date" name="fechaQAInicio"></td>
                <td><input type="date" name="fechaQAFin"></td>
                <td><input type="number" name="horasQA" value="8"></td>
            </tr>
            <tr>
                <td>6. Correcci√≥n de Bugs (si aplica)</td>
                <td><input type="date" name="fechaBugsInicio"></td>
                <td><input type="date" name="fechaBugsFin"></td>
                <td><input type="number" name="horasBugs" value="4"></td>
            </tr>
            <tr>
                <td>7. Review con Stakeholder</td>
                <td><input type="date" name="fechaReviewInicio"></td>
                <td><input type="date" name="fechaReviewFin"></td>
                <td><input type="number" name="horasReview" value="2"></td>
            </tr>
        </table>

        <button id="agregar-a-planeacion-btn">AGREGAR A PLANEACI√ìN</button>
    </div>

    <div id="resultados-planeacion" class="section">
        <h2>Planeaci√≥n Agregada</h2>
        <table id="tabla-resultados">
            <thead>
                <tr>
                    <th>Nro de Sprint</th><th>ID HU</th><th>Nombre HU</th><th>Actividad</th>
                    <th>Fecha Inicio</th><th>Fecha Fin</th><th>Horas</th><th>DEV</th><th>QA</th><th>Acciones</th>
                </tr>
            </thead>
            <tbody></tbody>
        </table>
        <button id="limpiar-planeacion-btn" class="clear-btn">Limpiar Planeaci√≥n</button>
    </div>

    <div class="section">
        <h2>Secci√≥n 2: Actividades Fijas del Sprint</h2>
        <table id="tabla-fijas-form">
            <tr>
                <th>#</th><th>Actividad</th><th>D√≠a(s)</th><th>Duraci√≥n estimada (d√≠as)</th><th>Fecha</th>
            </tr>
            <tr>
                <td>1</td><td>Declaraci√≥n de inicio de Sprint</td><td>D√≠a 1</td><td>0.125</td>
                <td><input type="date" name="fechaInicio"></td>
            </tr>
            <tr>
                <td>2</td><td>Daily Scrum √ó 15</td><td>D√≠as 1‚Äì15</td><td>0.375</td>
                <td><em>Fijo</em></td>
            </tr>
            <tr>
                <td>3</td><td>Refinamiento 1</td><td>D√≠a 6</td><td>0.125</td>
                <td><input type="date" name="fechaRef1"></td>
            </tr>
            <tr>
                <td>4</td><td>Puntuaci√≥n 1</td><td>D√≠a 9</td><td>0.125</td>
                <td><input type="date" name="fechaPunt1"></td>
            </tr>
            <tr>
                <td>5</td><td>Refinamiento 2</td><td>D√≠a 11</td><td>0.125</td>
                <td><input type="date" name="fechaRef2"></td>
            </tr>
            <tr>
                <td>6</td><td>Puntuaci√≥n 2</td><td>D√≠a 13</td><td>0.125</td>
                <td><input type="date" name="fechaPunt2"></td>
            </tr>
            <tr>
                <td>7</td><td>Retrospectiva Sprint Actual</td><td>D√≠a 15 (AM)</td><td>0.125</td>
                <td><input type="date" name="fechaRetro"></td>
            </tr>
            <tr>
                <td>8</td><td>Planning del Nuevo Sprint</td><td>D√≠a 15 (PM)</td><td>0.25</td>
                <td><input type="date" name="fechaPlanning"></td>
            </tr>
            <tr>
                <td>9</td><td>Cierre de Sprint</td><td>D√≠a 15 (PM)</td><td>0.125</td>
                <td><input type="date" name="fechaCierre"></td>
            </tr>
             <tr>
                <td>10</td><td>An√°lisis Exploratorio de HU (16 horas)</td><td>Var√≠a</td><td>2</td>
                <td><input type="date" name="fechaAnalisisExploratorio"></td>
            </tr>
        </table>
    </div>

	    </div>  <div class="section">
    <h2>Secci√≥n 3: Otras Actividades</h2>

    <div class="form-row">
      <label for="otraActividad">Actividad:</label>
      <input type="text" id="otraActividad" name="otraActividad">
    </div>
    <div class="form-row">
      <label for="otraInicio">Fecha Inicio:</label>
      <input type="date" id="otraInicio" name="otraInicio">
    </div>
    <div class="form-row">
      <label for="otraFin">Fecha Fin:</label>
      <input type="date" id="otraFin" name="otraFin">
    </div>
    <div class="form-row">
      <label for="otraHoras">Horas/D√≠as:</label>
      <input type="number" id="otraHoras" name="otraHoras">
    </div>
    <div class="form-row">
      <label for="otraResp">Responsable:</label>
      <input type="text" id="otraResp" name="otraResp">
    </div>

    <button id="agregar-otra-btn" class="submit-btn">Agregar Otra Actividad</button>

    <h3>Resumen de Otras Actividades A√±adidas</h3>
    <table id="tabla-otras-actividades">
      <thead>
        <tr>
          <th>Actividad</th>
          <th>Inicio</th>
          <th>Fin</th>
          <th>Horas/D√≠as</th>
          <th>Responsable</th>
          <th>Acciones</th>
        </tr>
      </thead>
      <tbody></tbody>
    </table>
  </div>
  <div id="resumen-planeacion" class="section">
        <h2>Resumen de Planeaci√≥n Agregada</h2>
        <table id="tabla-resumen-agregada">
            <thead>
                <tr>
                    <th>Nro Sprint</th><th>ID HU</th><th>Nombre HU</th><th>Actividad</th>
                    <th>Inicio</th><th>Fin</th><th>Horas</th><th>DEV</th><th>QA</th>
                </tr>
            </thead>
            <tbody></tbody>
        </table>

        <h2>Resumen de Actividades Fijas</h2>
        <table id="tabla-resumen-fijas">
            <thead>
                <tr>
                    <th>#</th><th>Actividad</th><th>D√≠a(s)</th><th>Duraci√≥n (d√≠as)</th><th>Fecha</th>
                </tr>
            </thead>
            <tbody></tbody>
        </table>

        <h2>Resumen de Otras Actividades</h2>
        <table id="tabla-resumen-otras">
            <thead>
                <tr>
                    <th>Actividad</th>
                    <th>Inicio</th>
                    <th>Fin</th>
                    <th>Horas/D√≠as</th>
                    <th>Responsable</th>
                </tr>
            </thead>
            <tbody></tbody>
        </table>


        <button id="exportar-excel-btn" class="submit-btn">Exportar a Excel</button>
    </div>


    <div style="text-align:center;">
        <button id="guardar-planeacion-btn" class="submit-btn">Guardar Planeaci√≥n</button>
        <button id="limpiar-resumen-btn" class="clear-btn">Limpiar Resumen</button>
    </div>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
    <script>
      // A√±adir a Planeaci√≥n
      document.getElementById('agregar-a-planeacion-btn').addEventListener('click', () => {
        const nroSprint   = document.getElementById('nroSprint').value;
        const huId        = document.getElementById('huId').value;
        const huName      = document.getElementById('huName').value;
        const devAsignado = document.getElementById('devAsignado').value;
        const qaAsignado  = document.getElementById('qaAsignado').value;

        const actividades = [
          { act:'Desarrollo',      inicio:'fechaDesarrolloInicio', fin:'fechaDesarrolloFin', horas:'horasDesarrollo' },
          { act:'Dise√±o de casos de prueba (en paralelo con desarrollo)',       inicio:'fechaDisenoQAInicio',  fin:'fechaDisenoQAFin',  horas:'horasDisenoQA'  },
          { act:'Handoff t√©cnico',  inicio:'fechaHandoffInicio',   fin:'fechaHandoffFin',   horas:'horasHandoff'   },
          { act:'Liberaci√≥n a ambiente Dev (Deploy inicial)',       inicio:'fechaDeployInicio',    fin:'fechaDeployFin',    horas:'horasDeploy'    },
          { act:'Validaci√≥n QA (Ejecuci√≥n formal de pruebas)',    inicio:'fechaQAInicio',        fin:'fechaQAFin',        horas:'horasQA'        },
          { act:'Correcci√≥n de Bugs (si aplica)',  inicio:'fechaBugsInicio',      fin:'fechaBugsFin',      horas:'horasBugs'      },
          { act:'Review con Stakeholder', inicio:'fechaReviewInicio',  fin:'fechaReviewFin',    horas:'horasReview'    }
        ];

        const body = document.querySelector('#tabla-resultados tbody');

        actividades.forEach(a => {
          const r = body.insertRow();
          r.insertCell().textContent = nroSprint;
          r.insertCell().textContent = huId;
          r.insertCell().textContent = huName;
          r.insertCell().textContent = a.act;
          r.insertCell().textContent = document.querySelector(`input[name="${a.inicio}"]`).value;
          r.insertCell().textContent = document.querySelector(`input[name="${a.fin}"]`).value;
          r.insertCell().textContent = document.querySelector(`input[name="${a.horas}"]`).value;
          r.insertCell().textContent = devAsignado;
          r.insertCell().textContent = qaAsignado;
          const cellAcc = r.insertCell();

          // Bot√≥n Editar para Planeaci√≥n Agregada
          const eBtn = document.createElement('button');
          eBtn.textContent = 'Editar';
          eBtn.className = 'edit-btn';
          eBtn.addEventListener('click', () => {
              // Cargar datos de la fila al formulario de la Secci√≥n 1
              document.getElementById('nroSprint').value = r.cells[0].textContent;
              document.getElementById('huId').value = r.cells[1].textContent;
              document.getElementById('huName').value = r.cells[2].textContent;
              document.getElementById('devAsignado').value = r.cells[7].textContent;
              document.getElementById('qaAsignado').value = r.cells[8].textContent;

              // Nota: Cargar fechas y horas a los inputs correctos requiere mapeo por nombre de actividad.
              // Esto es una implementaci√≥n b√°sica. Para una edici√≥n completa, deber√≠as identificar qu√© actividad es
              // la de esta fila (ej: "Desarrollo", "Dise√±o QA", etc.) y cargar los valores en los inputs correspondientes.
              // Aqu√≠ solo cargamos los campos generales de la HU.

              alert('Datos cargados al formulario de la Secci√≥n 1. Modifica y agrega nuevamente. Deber√°s eliminar la fila original.');
          });
          cellAcc.append(eBtn);

          // Bot√≥n Eliminar para Planeaci√≥n Agregada
          const dBtn = document.createElement('button');
          dBtn.textContent = 'Eliminar';
          dBtn.className = 'delete-btn';
          dBtn.addEventListener('click', () => {
              r.remove(); // Eliminar la fila
          });
          cellAcc.append(dBtn);

        });

        // Reset formulario Secci√≥n 1
        ['nroSprint','huId','huName','devAsignado','qaAsignado'].forEach(id=>document.getElementById(id).value='');
        actividades.forEach(a=>{
          // Tambi√©n resetear los campos de fecha y hora
          const inicioInput = document.querySelector(`input[name="${a.inicio}"]`);
          if(inicioInput) inicioInput.value = '';
          const finInput = document.querySelector(`input[name="${a.fin}"]`);
          if(finInput) finInput.value = '';
          const horasInput = document.querySelector(`input[name="${a.horas}"]`);
           if(horasInput) {
             // Resetear horas a sus valores por defecto si es posible
             const defaultHours = {
               'horasDesarrollo': 16,
               'horasDisenoQA': 8,
               'horasHandoff': 2,
               'horasDeploy': 2,
               'horasQA': 8,
               'horasBugs': 4,
               'horasReview': 2
             };
             horasInput.value = defaultHours[a.horas] || ''; // Usa el valor por defecto o vac√≠o
           }
        });
      });

      // Guardar Planeaci√≥n
      document.getElementById('guardar-planeacion-btn').addEventListener('click', () => {
        // 1) Planeaci√≥n Agregada
        const planeAg = [];
        document.querySelectorAll('#tabla-resultados tbody tr').forEach(r => {
          const c=r.children;
          planeAg.push({
            nroSprint:c[0].textContent, huId:c[1].textContent, huName:c[2].textContent,
            actividad:c[3].textContent, inicio:c[4].textContent, fin:c[5].textContent,
            horas:c[6].textContent, dev:c[7].textContent, qa:c[8].textContent
          });
        });

        // 2) Actividades Fijas
        const fij = [];
        // Itera sobre todas las filas de la tabla de actividades fijas (excluyendo el encabezado)
        document.querySelectorAll('#tabla-fijas-form tr:not(:first-child)').forEach(r=> {
          const c=r.children;
          fij.push({
            numero:c[0].textContent,
            actividad:c[1].textContent,
            dias:c[2].textContent,
            duracion:c[3].textContent,
            // Intenta obtener el valor del input de fecha, si existe
            fecha: r.querySelector('input[type="date"]') ? r.querySelector('input[type="date"]').value : ''
          });
        });

        // 3) Otras Actividades
        const otrasActs = [];
        document.querySelectorAll('#tabla-otras-actividades tbody tr').forEach(r => {
            const c = r.children;
            // Asegurarse de tomar solo las celdas de datos, no la de acciones para el resumen/guardado
            otrasActs.push({
                actividad: c[0].textContent,
                inicio: c[1].textContent,
                fin: c[2].textContent,
                horas: c[3].textContent,
                responsable: c[4].textContent
            });
        });


        // 4) Volcar a resumen
        const ra=document.querySelector('#tabla-resumen-agregada tbody');
        const rf=document.querySelector('#tabla-resumen-fijas tbody');
        const ro = document.querySelector('#tabla-resumen-otras tbody'); // Resumen Otras Actividades
        ra.innerHTML=''; rf.innerHTML=''; ro.innerHTML=''; // Limpiar las tablas de resumen

        planeAg.forEach(i=> {
          const r=ra.insertRow();
          Object.values(i).forEach(v=>r.insertCell().textContent=v);
        });
        fij.forEach(i=> {
          const r=rf.insertRow();
          // Asegurarse de que el orden de las celdas coincida con el thead del resumen
          r.insertCell().textContent = i.numero;
          r.insertCell().textContent = i.actividad;
          r.insertCell().textContent = i.dias;
          r.insertCell().textContent = i.duracion;
          r.insertCell().textContent = i.fecha;
        });
        // Volcar otras actividades al resumen
        otrasActs.forEach(i => {
            const r = ro.insertRow();
            Object.values(i).forEach(v => r.insertCell().textContent = v);
        });


        // 5) LocalStorage - Puedes guardar estos arrays si necesitas persistencia
        // localStorage.setItem('planeAg',JSON.stringify(planeAg));
        // localStorage.setItem('fijas',JSON.stringify(fij));
        // localStorage.setItem('otrasActs',JSON.stringify(otrasActs));
        alert('Res√∫menes generados. Los datos est√°n listos para exportar a Excel.');
      });

      // Limpiar tabla resultados (Planeaci√≥n Agregada)
      document.getElementById('limpiar-planeacion-btn').onclick = () => {
        document.querySelector('#tabla-resultados tbody').innerHTML='';
      };

      // Limpiar res√∫menes
      document.getElementById('limpiar-resumen-btn').addEventListener('click', () => {
        document.querySelector('#tabla-resumen-agregada tbody').innerHTML = '';
        document.querySelector('#tabla-resumen-fijas tbody').innerHTML = '';
        document.querySelector('#tabla-resumen-otras tbody').innerHTML = '';
      });

      // === L√≥gica Secci√≥n 3: Otras Actividades ===
      document.addEventListener('DOMContentLoaded', () => {
        const btnAgregarOtra = document.getElementById('agregar-otra-btn');
        const tablaOtrasBody = document.querySelector('#tabla-otras-actividades tbody');

        btnAgregarOtra.addEventListener('click', () => {
          const act  = document.getElementById('otraActividad').value.trim();
          const ini  = document.getElementById('otraInicio').value;
          const fin  = document.getElementById('otraFin').value;
          const hrs  = document.getElementById('otraHoras').value;
          const resp = document.getElementById('otraResp').value.trim();

          if (!act || !ini || !fin || !hrs || !resp) {
            alert('Por favor completa todos los campos de Otras Actividades.');
            return;
          }

          // Inserta la fila en la tabla de Secci√≥n 3
          const fila = tablaOtrasBody.insertRow();
          fila.insertCell().textContent = act;
          fila.insertCell().textContent = ini;
          fila.insertCell().textContent = fin;
          fila.insertCell().textContent = hrs;
          fila.insertCell().textContent = resp;

          // Botones de Acci√≥n para Otras Actividades
          const cellAcc = fila.insertCell();
          const btnEdit = document.createElement('button');
          btnEdit.textContent = 'Editar';
          btnEdit.className = 'edit-btn';
           btnEdit.addEventListener('click', () => {
                // Cargar datos de la fila al formulario de Otras Actividades
                document.getElementById('otraActividad').value = fila.cells[0].textContent;
                document.getElementById('otraInicio').value = fila.cells[1].textContent;
                document.getElementById('otraFin').value = fila.cells[2].textContent;
                document.getElementById('otraHoras').value = fila.cells[3].textContent;
                document.getElementById('otraResp').value = fila.cells[4].textContent;
                // Eliminar la fila original despu√©s de cargar los datos
                fila.remove();
           });

          const btnDel = document.createElement('button');
          btnDel.textContent = 'Eliminar';
          btnDel.className = 'delete-btn';
          btnDel.addEventListener('click', () => fila.remove());

          cellAcc.append(btnEdit, btnDel);

          // Limpia el formulario de Otras Actividades
          ['otraActividad','otraInicio','otraFin','otraHoras','otraResp']
            .forEach(id => document.getElementById(id).value = '');
        });

        // Exportar a Excel
        document.getElementById('exportar-excel-btn').addEventListener('click', () => {
          const wb = XLSX.utils.book_new();
          wb.Props = { Title: "Planeaci√≥n Sprint", Author: "Equipo" };

          // Asegurarse de que las tablas de resumen tengan contenido antes de exportar
          // Puedes llamar a guardar planeaci√≥n primero si quieres asegurar que los res√∫menes est√©n actualizados
          // document.getElementById('guardar-planeacion-btn').click(); // Descomentar si quieres forzar el guardado antes de exportar

          const wsAg  = XLSX.utils.table_to_sheet(document.getElementById('tabla-resumen-agregada'));
          const wsFi  = XLSX.utils.table_to_sheet(document.getElementById('tabla-resumen-fijas'));
          const wsOtr = XLSX.utils.table_to_sheet(document.getElementById('tabla-resumen-otras')); // Exportar la tabla de resumen de Otras Actividades

          XLSX.utils.book_append_sheet(wb, wsAg, "PlaneAg");
          XLSX.utils.book_append_sheet(wb, wsFi, "ActFijas");
          XLSX.utils.book_append_sheet(wb, wsOtr, "OtrasActs"); // A√±adir la nueva hoja al Excel

          XLSX.writeFile(wb, "planeacion_sprint.xlsx");
        });
      });
      // === Fin L√≥gica Secci√≥n 3 ===


    </script>
</body>
</html>
