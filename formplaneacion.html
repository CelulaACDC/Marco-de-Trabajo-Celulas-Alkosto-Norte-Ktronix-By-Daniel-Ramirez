<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Plantilla de Planeaci√≥n de Sprint</title>
    <style>
        body { font-family: Arial, sans-serif; background-color: #f4f6f9; color: #333; margin: 20px; }
        h1, h2 { text-align: center; color: #003366; }
        .section { background-color: #fff; padding: 20px; border-radius: 8px; box-shadow: 0 2px 5px rgba(0,0,0,0.1); margin-bottom: 30px; }

        /* Tablas */
        table { width: 100%; border-collapse: collapse; margin-top: 10px; }
        th, td { border: 1px solid #ddd; padding: 10px; text-align: left; }
        tr:nth-child(even) td { background-color: #f9f9f9; }

        /* Formularios secci√≥n 1 */
        .form-row { display: flex; align-items: center; margin-bottom: 10px; }
        .form-row label { width: 180px; margin-right: 10px; text-align: right; }
        .form-row input[type="text"] { width: calc(100% - 190px); padding: 8px; border: 1px solid #ccc; border-radius: 4px; }

        /* Encabezados de tabla secci√≥n1 */
        .section1-table th { background-color: #007bff; color: #fff; }
        .section1-table input { width: 100%; padding: 6px; border: 1px solid #ccc; border-radius: 4px; box-sizing: border-box; }

        /* Botones */
        .submit-btn { background-color: #28a745; color: #fff; padding: 10px 20px; border: none; border-radius: 6px; cursor: pointer; font-size: 1em; }
        .submit-btn:hover { background-color: #218838; }
        #agregar-a-planeacion-btn { background-color: #007bff; color: #fff; padding: 8px 16px; border: none; border-radius: 4px; cursor: pointer; font-size: 0.9em; }
        #agregar-a-planeacion-btn:hover { background-color: #0056b3; }
        .edit-btn { background-color: #ffc107; color: #fff; border: none; padding: 5px 10px; border-radius: 4px; cursor: pointer; font-size: 0.8em; margin-right: 5px; }
        .edit-btn:hover { background-color: #e0a800; }
        .delete-btn { background-color: #dc3545; color: #fff; border: none; padding: 5px 10px; border-radius: 4px; cursor: pointer; font-size: 0.8em; }
        .delete-btn:hover { background-color: #c82333; }
        .clear-btn { background-color: #6c757d; color: #fff; padding: 8px 16px; border: none; border-radius: 4px; cursor: pointer; font-size: 0.9em; }
        .clear-btn:hover { background-color: #5a6268; }

        /* Tablas de resumen */
        #tabla-resumen-agregada th, #tabla-resumen-fijas th { background-color: #28a745; color: #fff; }
    </style>
</head>
<body>

    <h1>üìã Planeaci√≥n de Sprint</h1>

    <!-- Secci√≥n 1 -->
    <div class="section">
        <h2>Secci√≥n 1: Actividades por Historia de Usuario (HU)</h2>

        <div class="form-row">
            <label for="nroSprint">NRO DE SPRINT:</label>
            <input type="text" id="nroSprint" name="nroSprint">
        </div>
        <div class="form-row">
            <label for="huId">ID de Historia de Usuario (HU):</label>
            <input type="text" id="huId" name="huId">
        </div>
        <div class="form-row">
            <label for="huName">Nombre de la HU:</label>
            <input type="text" id="huName" name="huName">
        </div>
        <div class="form-row">
            <label for="devAsignado">DEV ASIGNADO:</label>
            <input type="text" id="devAsignado" name="devAsignado">
        </div>
        <div class="form-row">
            <label for="qaAsignado">QA ASIGNADO:</label>
            <input type="text" id="qaAsignado" name="qaAsignado">
        </div>

        <table class="section1-table">
            <tr>
                <th>Actividad</th><th>Fecha Inicio</th><th>Fecha Fin</th><th>Horas (sugerido)</th>
            </tr>
            <tr>
                <td>1. Desarrollo</td>
                <td><input type="date" name="fechaDesarrolloInicio"></td>
                <td><input type="date" name="fechaDesarrolloFin"></td>
                <td><input type="number" name="horasDesarrollo" value="16"></td>
            </tr>
            <tr>
                <td>2. Dise√±o de casos de prueba (en paralelo con desarrollo)</td>
                <td><input type="date" name="fechaDisenoQAInicio"></td>
                <td><input type="date" name="fechaDisenoQAFin"></td>
                <td><input type="number" name="horasDisenoQA" value="8"></td>
            </tr>
            <tr>
                <td>3. Handoff t√©cnico</td>
                <td><input type="date" name="fechaHandoffInicio"></td>
                <td><input type="date" name="fechaHandoffFin"></td>
                <td><input type="number" name="horasHandoff" value="2"></td>
            </tr>
            <tr>
                <td>4. Liberaci√≥n a ambiente Dev (Deploy inicial)</td>
                <td><input type="date" name="fechaDeployInicio"></td>
                <td><input type="date" name="fechaDeployFin"></td>
                <td><input type="number" name="horasDeploy" value="2"></td>
            </tr>
            <tr>
                <td>5. Validaci√≥n QA (Ejecuci√≥n formal de pruebas)</td>
                <td><input type="date" name="fechaQAInicio"></td>
                <td><input type="date" name="fechaQAFin"></td>
                <td><input type="number" name="horasQA" value="8"></td>
            </tr>
            <tr>
                <td>6. Correcci√≥n de Bugs (si aplica)</td>
                <td><input type="date" name="fechaBugsInicio"></td>
                <td><input type="date" name="fechaBugsFin"></td>
                <td><input type="number" name="horasBugs" value="4"></td>
            </tr>
            <tr>
                <td>7. Review con Stakeholder</td>
                <td><input type="date" name="fechaReviewInicio"></td>
                <td><input type="date" name="fechaReviewFin"></td>
                <td><input type="number" name="horasReview" value="2"></td>
            </tr>
        </table>

        <button id="agregar-a-planeacion-btn">AGREGAR A PLANEACI√ìN</button>
    </div>

    <!-- Resultados parciales -->
    <div id="resultados-planeacion" class="section">
        <h2>Planeaci√≥n Agregada</h2>
        <table id="tabla-resultados">
            <thead>
                <tr>
                    <th>Nro de Sprint</th><th>ID HU</th><th>Nombre HU</th><th>Actividad</th>
                    <th>Fecha Inicio</th><th>Fecha Fin</th><th>Horas</th><th>DEV</th><th>QA</th><th>Acciones</th>
                </tr>
            </thead>
            <tbody></tbody>
        </table>
        <button id="limpiar-planeacion-btn" class="clear-btn">Limpiar Planeaci√≥n</button>
    </div>

    <!-- Secci√≥n 2 -->
    <div class="section">
        <h2>Secci√≥n 2: Actividades Fijas del Sprint</h2>
        <table id="tabla-fijas-form">
            <tr>
                <th>#</th><th>Actividad</th><th>D√≠a(s)</th><th>Duraci√≥n estimada (d√≠as)</th><th>Fecha</th>
            </tr>
            <tr>
                <td>1</td><td>Declaraci√≥n de inicio de Sprint</td><td>D√≠a 1</td><td>0.125</td>
                <td><input type="date" name="fechaInicio"></td>
            </tr>
            <tr>
                <td>2</td><td>Daily Scrum √ó 15</td><td>D√≠as 1‚Äì15</td><td>0.375</td>
                <td><em>Fijo</em></td>
            </tr>
            <tr>
                <td>3</td><td>Refinamiento 1</td><td>D√≠a 6</td><td>0.125</td>
                <td><input type="date" name="fechaRef1"></td>
            </tr>
            <tr>
                <td>4</td><td>Puntuaci√≥n 1</td><td>D√≠a 9</td><td>0.125</td>
                <td><input type="date" name="fechaPunt1"></td>
            </tr>
            <tr>
                <td>5</td><td>Refinamiento 2</td><td>D√≠a 11</td><td>0.125</td>
                <td><input type="date" name="fechaRef2"></td>
            </tr>
            <tr>
                <td>6</td><td>Puntuaci√≥n 2</td><td>D√≠a 13</td><td>0.125</td>
                <td><input type="date" name="fechaPunt2"></td>
            </tr>
            <tr>
                <td>7</td><td>Retrospectiva Sprint Actual</td><td>D√≠a 15 (AM)</td><td>0.125</td>
                <td><input type="date" name="fechaRetro"></td>
            </tr>
            <tr>
                <td>8</td><td>Planning del Nuevo Sprint</td><td>D√≠a 15 (PM)</td><td>0.25</td>
                <td><input type="date" name="fechaPlanning"></td>
            </tr>
            <tr>
                <td>9</td><td>Cierre de Sprint</td><td>D√≠a 15 (PM)</td><td>0.125</td>
                <td><input type="date" name="fechaCierre"></td>
            </tr>
        </table>
    </div>

    <!-- Resumen final -->
    <div id="resumen-planeacion" class="section">
        <h2>Resumen de Planeaci√≥n Agregada</h2>
        <table id="tabla-resumen-agregada">
            <thead>
                <tr>
                    <th>Nro Sprint</th><th>ID HU</th><th>Nombre HU</th><th>Actividad</th>
                    <th>Inicio</th><th>Fin</th><th>Horas</th><th>DEV</th><th>QA</th>
                </tr>
            </thead>
            <tbody></tbody>
        </table>

        <h2>Resumen de Actividades Fijas</h2>
        <table id="tabla-resumen-fijas">
            <thead>
                <tr>
                    <th>#</th><th>Actividad</th><th>D√≠a(s)</th><th>Duraci√≥n (d√≠as)</th><th>Fecha</th>
                </tr>
            </thead>
            <tbody></tbody>
        </table>

        <button id="exportar-excel-btn" class="submit-btn">Exportar a Excel</button>
    </div>

    <div style="text-align:center;">
        <button id="guardar-planeacion-btn" class="submit-btn">Guardar Planeaci√≥n</button>
    </div>

    <!-- XLSX.js -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
    <script>
      // A√±adir a Planeaci√≥n
      document.getElementById('agregar-a-planeacion-btn').addEventListener('click', () => {
        const nroSprint   = document.getElementById('nroSprint').value;
        const huId        = document.getElementById('huId').value;
        const huName      = document.getElementById('huName').value;
        const devAsignado = document.getElementById('devAsignado').value;
        const qaAsignado  = document.getElementById('qaAsignado').value;

        const actividades = [
          { act:'Desarrollo',      inicio:'fechaDesarrolloInicio', fin:'fechaDesarrolloFin', horas:'horasDesarrollo' },
          { act:'Dise√±o QA',       inicio:'fechaDisenoQAInicio',  fin:'fechaDisenoQAFin',  horas:'horasDisenoQA'  },
          { act:'Handoff t√©cnico',  inicio:'fechaHandoffInicio',   fin:'fechaHandoffFin',   horas:'horasHandoff'   },
          { act:'Deploy Dev',       inicio:'fechaDeployInicio',    fin:'fechaDeployFin',    horas:'horasDeploy'    },
          { act:'Validaci√≥n QA',    inicio:'fechaQAInicio',        fin:'fechaQAFin',        horas:'horasQA'        },
          { act:'Correcci√≥n Bugs',  inicio:'fechaBugsInicio',      fin:'fechaBugsFin',      horas:'horasBugs'      },
          { act:'Review Stakeholder', inicio:'fechaReviewInicio',  fin:'fechaReviewFin',    horas:'horasReview'    }
        ];

        const body = document.querySelector('#tabla-resultados tbody');
        actividades.forEach(a => {
          const r = body.insertRow();
          r.insertCell().textContent = nroSprint;
          r.insertCell().textContent = huId;
          r.insertCell().textContent = huName;
          r.insertCell().textContent = a.act;
          r.insertCell().textContent = document.querySelector(`input[name="${a.inicio}"]`).value;
          r.insertCell().textContent = document.querySelector(`input[name="${a.fin}"]`).value;
          r.insertCell().textContent = document.querySelector(`input[name="${a.horas}"]`).value;
          r.insertCell().textContent = devAsignado;
          r.insertCell().textContent = qaAsignado;
          const cellAcc = r.insertCell();
          const eBtn = document.createElement('button'); eBtn.textContent='Editar'; eBtn.className='edit-btn';
          const dBtn = document.createElement('button'); dBtn.textContent='Eliminar'; dBtn.className='delete-btn';
          cellAcc.append(eBtn,dBtn);
        });

        // Reset formulario
        ['nroSprint','huId','huName','devAsignado','qaAsignado'].forEach(id=>document.getElementById(id).value='');
        actividades.forEach(a=>{
          document.querySelector(`input[name="${a.inicio}"]`).value='';
          document.querySelector(`input[name="${a.fin}"]`).value='';
          document.querySelector(`input[name="${a.horas}"]`).value=a.horas==='horasDesarrollo'?16:
                                                                  a.horas==='horasDisenoQA'?8:
                                                                  a.horas==='horasHandoff'?2:
                                                                  a.horas==='horasDeploy'?2:
                                                                  a.horas==='horasQA'?8:4;
        });
      });

      // Guardar Planeaci√≥n
      document.getElementById('guardar-planeacion-btn').addEventListener('click', () => {
        // 1) Planeaci√≥n Agregada
        const planeAg = [];
        document.querySelectorAll('#tabla-resultados tbody tr').forEach(r => {
          const c=r.children;
          planeAg.push({
            nroSprint:c[0].textContent, huId:c[1].textContent, huName:c[2].textContent,
            actividad:c[3].textContent, inicio:c[4].textContent, fin:c[5].textContent,
            horas:c[6].textContent, dev:c[7].textContent, qa:c[8].textContent
          });
        });

        // 2) Actividades Fijas
        const fij = [];
        document.querySelectorAll('#tabla-fijas-form tr:not(:first-child)').forEach(r=> {
          const c=r.children;
          fij.push({
            numero:c[0].textContent, actividad:c[1].textContent, dias:c[2].textContent,
            duracion:c[3].textContent,
            fecha:r.querySelector('input')? r.querySelector('input').value : ''
          });
        });

        // 3) Volcar a resumen
        const ra=document.querySelector('#tabla-resumen-agregada tbody');
        const rf=document.querySelector('#tabla-resumen-fijas tbody');
        ra.innerHTML=''; rf.innerHTML='';
        planeAg.forEach(i=> {
          const r=ra.insertRow();
          Object.values(i).forEach(v=>r.insertCell().textContent=v);
        });
        fij.forEach(i=> {
          const r=rf.insertRow();
          Object.values(i).forEach(v=>r.insertCell().textContent=v);
        });

        // 4) LocalStorage
        localStorage.setItem('planeAg',JSON.stringify(planeAg));
        localStorage.setItem('fijas',JSON.stringify(fij));
        alert('Planeaci√≥n guardada');
      });

      // Limpiar tabla resultados
      document.getElementById('limpiar-planeacion-btn').onclick = () => {
        document.querySelector('#tabla-resultados tbody').innerHTML='';
      };

      // Exportar Excel
      document.getElementById('exportar-excel-btn').addEventListener('click', () => {
        const wb = XLSX.utils.book_new();
        wb.Props = { Title:"Planeaci√≥n Sprint", Author:"Equipo" };
        const ws1 = XLSX.utils.table_to_sheet(document.getElementById('tabla-resumen-agregada'));
        const ws2 = XLSX.utils.table_to_sheet(document.getElementById('tabla-resumen-fijas'));
        XLSX.utils.book_append_sheet(wb, ws1, "PlaneAg");
        XLSX.utils.book_append_sheet(wb, ws2, "ActFijas");
        XLSX.writeFile(wb, "planeacion_sprint.xlsx");
      });
    </script>
</body>
</html>
